# Реализация автоматической генерации меток GitLab

## Что было сделано

Добавлена функциональность автоматической генерации меток (labels) для GitLab issues на основе приоритета и категории комментариев code review.

## Изменения в коде

### 1. `src/gitlab-factory.ts`

Добавлены два новых приватных метода:

#### `buildLabelsFromComment(comment: CsvEntry, defaultLabels: string[]): string[]`
- Формирует массив меток из приоритета и категории комментария
- Объединяет метки по умолчанию с автоматически сгенерированными
- Возвращает полный массив меток для задачи GitLab

#### `getPriorityLabel(priority: number): string | null`
- Преобразует числовое значение приоритета в метку
- Маппинг:
  - `1` → `"minor"` (низкий приоритет)
  - `2` → `"major"` (средний приоритет)
  - `3` → `"critical"` (высокий приоритет)
  - `0` → `null` (приоритет не указан, метка не добавляется)

#### Изменения в методе `exportToGitLab()`
- Добавлен вызов `buildLabelsFromComment()` перед созданием задачи
- Метки теперь формируются динамически для каждого комментария

## Обновленная документация

### 1. `README.md`
- Обновлена секция `code-review.gitlab.defaultLabels`
- Добавлено описание автоматической генерации меток
- Добавлен пример результирующих меток

### 2. `docs/gitlab-integration-setup.md`
- Добавлена подсекция "Automatic Label Generation"
- Описаны правила генерации меток приоритета и категории
- Добавлен пример с объяснением преимуществ

### 3. `docs/gitlab-labels-ru.md` (новый файл)
- Полная документация на русском языке
- Таблица маппинга приоритетов
- Примеры использования
- Рекомендации по настройке цветов меток в GitLab

### 4. `CHANGELOG.md`
- Добавлена запись о новой функциональности в раздел [Unreleased]

## Как это работает

### Пример 1: Комментарий с высоким приоритетом и категорией

**Входные данные:**
```typescript
{
  priority: 3,
  category: "Security Issue",
  // ... другие поля
}
```

**Конфигурация:**
```json
{
  "code-review.gitlab.defaultLabels": ["code-review", "bug"]
}
```

**Результат:**
```javascript
["code-review", "bug", "critical", "security-issue"]
```

**Примечание:** Категория нормализуется: `"Security Issue"` → `"security-issue"` (нижний регистр, пробелы → дефисы)

### Пример 2: Комментарий без приоритета

**Входные данные:**
```typescript
{
  priority: 0,
  category: "Nitpick",
  // ... другие поля
}
```

**Результат:**
```javascript
["code-review", "bug", "nitpick"]
```
(метка приоритета не добавляется, категория нормализована)

### Пример 3: Комментарий без категории

**Входные данные:**
```typescript
{
  priority: 2,
  category: "",
  // ... другие поля
}
```

**Результат:**
```javascript
["code-review", "bug", "major"]
```
(метка категории не добавляется)

## Преимущества

1. **Автоматизация** - Метки добавляются автоматически без ручного ввода
2. **Консистентность** - Единообразное именование меток для всех задач
3. **Фильтрация** - Легко фильтровать задачи в GitLab по приоритету или категории
4. **Визуализация** - Цветные метки помогают быстро оценить важность задачи
5. **Интеграция** - Метки можно использовать в GitLab CI/CD и автоматизации

## Совместимость

- Изменения обратно совместимы
- Существующая функциональность не затронута
- Метки по умолчанию продолжают работать как раньше
- Новые метки добавляются дополнительно к существующим

## Тестирование

Для проверки функциональности:

1. Создайте комментарий с приоритетом 3 и категорией "security"
2. Экспортируйте комментарий в GitLab
3. Проверьте, что задача содержит метки: `critical` и `security`

## Дальнейшие улучшения (опционально)

1. Добавить настройку для кастомизации меток приоритета
2. Добавить поддержку множественных категорий
3. Добавить валидацию меток перед отправкой в GitLab
4. Добавить unit-тесты для новых методов
